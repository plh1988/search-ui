<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE-edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Document</title>
        <link rel="stylesheet" href="bootstrap.min.css">
        <style>
            body{
                background-color: rgb(90, 92, 94);
            }
            nav{
                background-color: #0a2769;
            }
        </style>
    </head>

    <body>
        <div class="container">
            <div class="row my-5">
                <div class="col-7">
                    <input type="text" list="searchInputValues" class="form-inline form-control" id="searchInput">
                    <datalist id="searchInputValues"></datalist>
                </div>
                <div class="col-5"><button class="btn btn-dark border border-white" id="search">Search</button></div>
            </div>
            <div class="container" >
                <div class="card-columns" id="dataRow">

                </div>
            </div>
        </div>
    </body>
</html>

<script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>

<script>
    $(document).ready(function() {
        $('#searchInput').on('keyup', function() {
            let searchText = searchInput.value;
            console.log(searchText.length);
            if (searchText.length > 0) {
                searchApiRequest(searchText);
            }
        });

        $('#search').on('click',function() {
            let searchText = searchInput.value;
            if (searchText.length > 0) {
                useApiData(searchText);
            }
        })
    });

    async function searchApiRequest(searchText) {
        let resposne = await fetch('http://localhost:8089/search/querySuggestion', {
            method: 'POST',
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({"q": `"${searchText}"`})
        });
        let data = await resposne.json();
        showList(data);
    }

    async function useApiData(searchText) {
        let resposne = await fetch('http://localhost:8089/search/query', {
            method: 'POST',
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({"q": `"${searchText}"`})
        });
        let data = await resposne.json();
        showResult(data);
    }

    function showList(data) {
        let list = '';
        for(let item of data.completions){
            list += `<option value="${item.expression}">`;
        }
        searchInputValues.innerHTML = list;
    }

    function showResult(data) {
        $('#search-result').show();
        let list = '';
        for(let item of data.results){
            let d = new Date(item.raw.date).toGMTString();
            list += `<div class="card mb-4 text-white bg-dark" style="width: 19rem;">
                        <div class="card-body">
                            <h5 class="card-title">${item.title}</h5>
                            <a href="${item.uri}">Link</a>
                            <p class="card-text"><small>Description : ${item.excerpt}</small></p>
                        </div>
                        <div class="card-footer"><small class="text-muted">Date : ${d}</small></div>
                    </div>`;
        }
        dataRow.innerHTML = list;
    }
    
</script>